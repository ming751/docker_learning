# ğŸ³ Docker è¯¦ç»†å·¥ä½œæµç¨‹æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è§£é‡Šæœ¬é¡¹ç›®ä¸­Dockerçš„å·¥ä½œæµç¨‹ã€å‘½ä»¤å«ä¹‰å’Œæœ€ä½³å®è·µã€‚

## ğŸ“‹ ç›®å½•

- [Docker åŸºæœ¬æ¦‚å¿µ](#docker-åŸºæœ¬æ¦‚å¿µ)
- [é¡¹ç›®Dockeræ¶æ„](#é¡¹ç›®dockeræ¶æ„)
- [Dockerfile è¯¦è§£](#dockerfile-è¯¦è§£)
- [Docker Compose è¯¦è§£](#docker-compose-è¯¦è§£)
- [è„šæœ¬å‘½ä»¤è¯¦è§£](#è„šæœ¬å‘½ä»¤è¯¦è§£)
- [å·¥ä½œæµç¨‹åˆ†æ](#å·¥ä½œæµç¨‹åˆ†æ)
- [å¸¸ç”¨Dockerå‘½ä»¤](#å¸¸ç”¨dockerå‘½ä»¤)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ğŸ”§ Docker åŸºæœ¬æ¦‚å¿µ

### æ ¸å¿ƒæ¦‚å¿µ

1. **é•œåƒ (Image)**: åªè¯»çš„æ¨¡æ¿ï¼ŒåŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„ä»£ç ã€è¿è¡Œæ—¶ã€åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶
2. **å®¹å™¨ (Container)**: é•œåƒçš„è¿è¡Œå®ä¾‹ï¼Œæ˜¯è½»é‡çº§ã€å¯ç§»æ¤çš„æ‰§è¡Œç¯å¢ƒ
3. **Dockerfile**: ç”¨äºæ„å»ºé•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«ä¸€ç³»åˆ—æŒ‡ä»¤
4. **Docker Compose**: ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨Dockeråº”ç”¨çš„å·¥å…·

### ä¼˜åŠ¿

- âœ… **ç¯å¢ƒä¸€è‡´æ€§**: å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´
- âœ… **å¿«é€Ÿéƒ¨ç½²**: ç§’çº§å¯åŠ¨ï¼Œæ¯”è™šæ‹Ÿæœºå¿«å¾—å¤š
- âœ… **èµ„æºé«˜æ•ˆ**: å…±äº«ä¸»æœºå†…æ ¸ï¼Œèµ„æºå ç”¨å°‘
- âœ… **ç‰ˆæœ¬æ§åˆ¶**: é•œåƒå¯ä»¥ç‰ˆæœ¬åŒ–ç®¡ç†
- âœ… **éš”ç¦»æ€§**: åº”ç”¨é—´ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å½±å“

## ğŸ—ï¸ é¡¹ç›®Dockeræ¶æ„

```
é¡¹ç›®æ¶æ„å›¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¿ä¸»æœº (Host)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                Docker å®¹å™¨ (Container)                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚              Ubuntu 20.04 ç¯å¢ƒ                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚           å¼€å‘å·¥å…·                               â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ GCC/G++                                     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ CMake                                       â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Git                                         â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ GDB (è°ƒè¯•å™¨)                                 â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Valgrind (å†…å­˜æ£€æŸ¥)                          â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ clang-format (ä»£ç æ ¼å¼åŒ–)                     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  å·¥ä½œç›®å½•: /workspace                                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  ç”¨æˆ·: developer (érootï¼Œå®‰å…¨)                        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  å·æ˜ å°„ (Volume Mounts):                                      â”‚
â”‚  â€¢ é¡¹ç›®ç›®å½• â†’ /workspace                                      â”‚
â”‚  â€¢ ccacheç¼“å­˜ â†’ /workspace/.ccache                           â”‚
â”‚  â€¢ Gité…ç½® â†’ /home/developer/.gitconfig                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“„ Dockerfile è¯¦è§£

è®©æˆ‘ä»¬é€è¡Œåˆ†æ `docker/ubuntu-local/Dockerfile`:

```dockerfile
# åŸºäº Ubuntu 20.04 LTS
FROM ubuntu:focal
```
**ä½œç”¨**: æŒ‡å®šåŸºç¡€é•œåƒã€‚`ubuntu:focal` æ˜¯Ubuntu 20.04 LTSçš„ä»£å·ã€‚

```dockerfile
# è®¾ç½®éäº¤äº’å¼ç¯å¢ƒï¼ˆé¿å…å®‰è£…æ—¶çš„äº¤äº’æç¤ºï¼‰
ENV DEBIAN_FRONTEND=noninteractive
```
**ä½œç”¨**: è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œé˜²æ­¢aptå®‰è£…åŒ…æ—¶å‡ºç°äº¤äº’å¼æç¤ºï¼Œç¡®ä¿è‡ªåŠ¨åŒ–å®‰è£…ã€‚

```dockerfile
# è®¾ç½®æ—¶åŒº
ENV TZ=Asia/Shanghai
```
**ä½œç”¨**: è®¾ç½®å®¹å™¨æ—¶åŒºä¸ºä¸Šæµ·æ—¶åŒºï¼ˆä¸œå…«åŒºï¼‰ã€‚

```dockerfile
# åˆ›å»ºérootç”¨æˆ·ï¼ˆå®‰å…¨æœ€ä½³å®è·µï¼‰
RUN useradd -m -s /bin/bash developer && \
    usermod -aG sudo developer
```
**ä½œç”¨**: 
- `useradd -m -s /bin/bash developer`: åˆ›å»ºç”¨æˆ·developerï¼Œåˆ›å»ºå®¶ç›®å½•(-m)ï¼Œè®¾ç½®shellä¸ºbash(-s)
- `usermod -aG sudo developer`: å°†developerç”¨æˆ·æ·»åŠ åˆ°sudoç»„ï¼Œè·å¾—ç®¡ç†å‘˜æƒé™

```dockerfile
# æ›´æ–°åŒ…åˆ—è¡¨å¹¶å®‰è£…å¼€å‘å·¥å…·
RUN apt-get update && apt-get install -y \
    # åŸºç¡€æ„å»ºå·¥å…·
    build-essential \
    cmake \
    ninja-build \
    pkg-config \
    # ç‰ˆæœ¬æ§åˆ¶
    git \
    # è°ƒè¯•å’Œåˆ†æå·¥å…·
    gdb \
    valgrind \
    # ä»£ç è´¨é‡å·¥å…·
    clang \
    clang-format \
    clang-tidy \
    # ç¼–è¯‘ç¼“å­˜
    ccache \
    # å®ç”¨å·¥å…·
    curl \
    wget \
    vim \
    nano \
    tree \
    htop \
    # æ¸…ç†ç¼“å­˜
    && rm -rf /var/lib/apt/lists/*
```
**ä½œç”¨**: å®‰è£…æ‰€æœ‰å¿…éœ€çš„å¼€å‘å·¥å…·å’Œå®ç”¨ç¨‹åºï¼Œæœ€åæ¸…ç†åŒ…ç¼“å­˜ä»¥å‡å°é•œåƒå¤§å°ã€‚

```dockerfile
# è®¾ç½® ccache è·¯å¾„ï¼ˆåŠ é€Ÿé‡å¤ç¼–è¯‘ï¼‰
ENV PATH=/usr/lib/ccache:$PATH
ENV CCACHE_DIR=/workspace/.ccache
```
**ä½œç”¨**: é…ç½®ccacheç¼–è¯‘ç¼“å­˜ï¼ŒåŠ é€Ÿé‡å¤ç¼–è¯‘è¿‡ç¨‹ã€‚

```dockerfile
# é…ç½® Gitï¼ˆå¯é€‰ï¼‰
RUN git config --global init.defaultBranch main
```
**ä½œç”¨**: è®¾ç½®Gité»˜è®¤åˆ†æ”¯åä¸ºmainã€‚

```dockerfile
# éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ
RUN gcc --version && \
    g++ --version && \
    cmake --version && \
    clang --version
```
**ä½œç”¨**: éªŒè¯å…³é”®å·¥å…·å®‰è£…æˆåŠŸï¼Œå¦‚æœå¤±è´¥ä¼šå¯¼è‡´é•œåƒæ„å»ºå¤±è´¥ã€‚

```dockerfile
# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /workspace
```
**ä½œç”¨**: è®¾ç½®å®¹å™¨å†…çš„é»˜è®¤å·¥ä½œç›®å½•ã€‚

```dockerfile
# åˆ‡æ¢åˆ°érootç”¨æˆ·
USER developer
```
**ä½œç”¨**: åˆ‡æ¢åˆ°éç‰¹æƒç”¨æˆ·ï¼Œæé«˜å®‰å…¨æ€§ã€‚

```dockerfile
# è®¾ç½®é»˜è®¤å‘½ä»¤
CMD ["/bin/bash"]
```
**ä½œç”¨**: è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶çš„é»˜è®¤å‘½ä»¤ã€‚

## ğŸ™ Docker Compose è¯¦è§£

è®©æˆ‘ä»¬åˆ†æ `docker/docker-compose.yaml`:

```yaml
version: '3.8'   # Docker Compose ç‰ˆæœ¬
```
**ä½œç”¨**: æŒ‡å®šDocker Composeæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬ã€‚

```yaml
services:        # å®šä¹‰æœåŠ¡
  dev-environment:  # æœåŠ¡åç§°
```
**ä½œç”¨**: å®šä¹‰æœåŠ¡ï¼Œå¯ä»¥æœ‰å¤šä¸ªæœåŠ¡ç»„æˆä¸€ä¸ªåº”ç”¨æ ˆã€‚

```yaml
    build:          # æ„å»ºé…ç½®
      context: ./ubuntu-local   # Dockerfileæ‰€åœ¨ç›®å½•
      args:
        - USER_ID=${USER_ID:-1000}
        - GROUP_ID=${GROUP_ID:-1000}
```
**ä½œç”¨**: 
- `context`: æŒ‡å®šæ„å»ºä¸Šä¸‹æ–‡ç›®å½•
- `args`: æ„å»ºå‚æ•°ï¼Œå¯ä»¥ä¼ é€’ç»™Dockerfileä¸­çš„ARGæŒ‡ä»¤

```yaml
    image: my-cpp-project:ubuntu-focal  # ç”Ÿæˆçš„é•œåƒåç§°
    container_name: my-cpp-dev          # å®¹å™¨åç§°
```
**ä½œç”¨**: æŒ‡å®šé•œåƒåç§°å’Œå®¹å™¨åç§°ã€‚

```yaml
    volumes:
      # æŒ‚è½½é¡¹ç›®ç›®å½•åˆ°å®¹å™¨
      - ..:/workspace
      # æŒ‚è½½ ccache ç¼“å­˜ç›®å½•ï¼ˆåŠ é€Ÿç¼–è¯‘ï¼‰
      - ccache-data:/workspace/.ccache
      # æŒ‚è½½ Git é…ç½®ï¼ˆå¯é€‰ï¼‰
      - ${HOME}/.gitconfig:/home/developer/.gitconfig:ro
```
**ä½œç”¨**: å·æŒ‚è½½é…ç½®
- `..:/workspace`: å°†é¡¹ç›®æ ¹ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„/workspace
- `ccache-data:/workspace/.ccache`: æŒä¹…åŒ–ç¼–è¯‘ç¼“å­˜
- `${HOME}/.gitconfig:/home/developer/.gitconfig:ro`: åªè¯»æŒ‚è½½Gité…ç½®

```yaml
    working_dir: /workspace
```
**ä½œç”¨**: è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶çš„å·¥ä½œç›®å½•ã€‚

```yaml
    environment:
      # è®¾ç½®ç¯å¢ƒå˜é‡
      - TERM=xterm-256color
      - CCACHE_DIR=/workspace/.ccache
```
**ä½œç”¨**: è®¾ç½®å®¹å™¨å†…çš„ç¯å¢ƒå˜é‡ã€‚

```yaml
    # ä¿æŒå®¹å™¨è¿è¡Œ
    tty: true           # åˆ†é…ä¼ªç»ˆç«¯
    stdin_open: true    # ä¿æŒæ ‡å‡†è¾“å…¥å¼€æ”¾
```
**ä½œç”¨**: 
- `tty: true`: åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯
- `stdin_open: true`: ä¿æŒSTDINå¼€æ”¾ï¼Œå³ä½¿æ²¡æœ‰é™„åŠ 

```yaml
    restart: unless-stopped
```
**ä½œç”¨**: é‡å¯ç­–ç•¥ï¼Œé™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™æ€»æ˜¯é‡å¯ã€‚

```yaml
volumes:
  ccache-data:  # æŒä¹…åŒ– ccache æ•°æ®
```
**ä½œç”¨**: å®šä¹‰å‘½åå·ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®ã€‚

## ğŸ” è„šæœ¬å‘½ä»¤è¯¦è§£

### docker_build.sh è¯¦è§£

```bash
#!/bin/bash
set -e
```
**ä½œç”¨**: 
- `#!/bin/bash`: æŒ‡å®šä½¿ç”¨bashè§£é‡Šå™¨
- `set -e`: é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

```bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"
echo "è„šæœ¬ç›®å½•: ${SCRIPT_DIR}"
```
**ä½œç”¨**: è·å–è„šæœ¬æ‰€åœ¨çš„ç»å¯¹è·¯å¾„ï¼Œæ— è®ºä»å“ªé‡Œè°ƒç”¨è„šæœ¬éƒ½èƒ½æ­£ç¡®å·¥ä½œã€‚

```bash
cd ${SCRIPT_DIR}/docker
```
**ä½œç”¨**: åˆ‡æ¢åˆ°dockerç›®å½•ï¼Œå› ä¸ºdocker-compose.yamlåœ¨è¿™é‡Œã€‚

```bash
docker compose up -d --build
```
**ä½œç”¨**: 
- `docker compose up`: å¯åŠ¨æœåŠ¡
- `-d`: åå°è¿è¡Œï¼ˆdetachedæ¨¡å¼ï¼‰
- `--build`: å¼ºåˆ¶é‡æ–°æ„å»ºé•œåƒ

```bash
docker exec -it my-cpp-dev /workspace/auto_build.sh --all
```
**ä½œç”¨**: 
- `docker exec`: åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤
- `-it`: äº¤äº’å¼ç»ˆç«¯
- `my-cpp-dev`: å®¹å™¨åç§°
- `/workspace/auto_build.sh --all`: è¦æ‰§è¡Œçš„å‘½ä»¤

### auto_build.sh è¯¦è§£

```bash
PARSED=$(getopt -o "$SHORT_OPTIONS" -l "$LONG_OPTIONS" -n "$0" -- "$@")
```
**ä½œç”¨**: ä½¿ç”¨getoptè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œæ”¯æŒçŸ­é€‰é¡¹å’Œé•¿é€‰é¡¹ã€‚

```bash
width=$(tput cols)
separator_line=$(printf '%*s' "$width" '' | tr ' ' '=')
```
**ä½œç”¨**: 
- `tput cols`: è·å–ç»ˆç«¯å®½åº¦
- `printf '%*s' "$width" ''`: åˆ›å»ºæŒ‡å®šå®½åº¦çš„ç©ºå­—ç¬¦ä¸²
- `tr ' ' '='`: å°†ç©ºæ ¼æ›¿æ¢ä¸ºç­‰å·ï¼Œåˆ›å»ºåˆ†éš”çº¿

```bash
nice -n20 make -j$(nproc)
```
**ä½œç”¨**: 
- `nice -n20`: ä»¥ä½ä¼˜å…ˆçº§è¿è¡Œï¼Œä¸å½±å“ç³»ç»Ÿå…¶ä»–è¿›ç¨‹
- `make -j$(nproc)`: å¹¶è¡Œç¼–è¯‘ï¼Œä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ

## ğŸ”„ å·¥ä½œæµç¨‹åˆ†æ

### å®Œæ•´å·¥ä½œæµç¨‹

```
1. ç”¨æˆ·æ‰§è¡Œ: ./docker_build.sh
   â†“
2. è„šæœ¬è·å–è‡ªèº«è·¯å¾„: SCRIPT_DIR
   â†“
3. åˆ‡æ¢åˆ°dockerç›®å½•: cd ${SCRIPT_DIR}/docker
   â†“
4. å¯åŠ¨DockeræœåŠ¡: docker compose up -d --build
   â”œâ”€ æ„å»ºé•œåƒ (å¦‚æœä¸å­˜åœ¨æˆ–éœ€è¦æ›´æ–°)
   â”œâ”€ åˆ›å»ºç½‘ç»œ
   â”œâ”€ åˆ›å»ºå·
   â””â”€ å¯åŠ¨å®¹å™¨
   â†“
5. ç­‰å¾…å®¹å™¨å¯åŠ¨: sleep 3
   â†“
6. åœ¨å®¹å™¨ä¸­æ‰§è¡Œæ„å»º: docker exec -it my-cpp-dev /workspace/auto_build.sh --all
   â”œâ”€ è§£æå‘½ä»¤è¡Œå‚æ•°
   â”œâ”€ åˆ›å»ºbuildç›®å½•
   â”œâ”€ è¿è¡Œcmakeé…ç½®
   â”œâ”€ ç¼–è¯‘é¡¹ç›®
   â”œâ”€ è¿è¡Œä¸»ç¨‹åº
   â””â”€ è¿è¡Œæµ‹è¯•
   â†“
7. æ„å»ºå®Œæˆï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
```

### é•œåƒæ„å»ºè¿‡ç¨‹

```
Dockeré•œåƒæ„å»ºæµç¨‹:
1. FROM ubuntu:focal
   â””â”€ ä¸‹è½½Ubuntu 20.04åŸºç¡€é•œåƒ
   
2. å®‰è£…ç³»ç»ŸåŒ…
   â”œâ”€ æ›´æ–°åŒ…åˆ—è¡¨: apt-get update
   â”œâ”€ å®‰è£…å¼€å‘å·¥å…·: build-essential, cmake, git...
   â””â”€ æ¸…ç†ç¼“å­˜: rm -rf /var/lib/apt/lists/*
   
3. é…ç½®ç”¨æˆ·å’Œç¯å¢ƒ
   â”œâ”€ åˆ›å»ºdeveloperç”¨æˆ·
   â”œâ”€ è®¾ç½®ç¯å¢ƒå˜é‡
   â””â”€ é…ç½®å·¥å…·
   
4. è®¾ç½®å·¥ä½œç›®å½•å’Œé»˜è®¤å‘½ä»¤
   â”œâ”€ WORKDIR /workspace
   â”œâ”€ USER developer
   â””â”€ CMD ["/bin/bash"]
```

### å®¹å™¨è¿è¡Œè¿‡ç¨‹

```
å®¹å™¨è¿è¡Œæµç¨‹:
1. docker compose up -d --build
   â”œâ”€ è¯»å–docker-compose.yaml
   â”œâ”€ æ„å»ºæˆ–æ‹‰å–é•œåƒ
   â”œâ”€ åˆ›å»ºç½‘ç»œ: docker_default
   â”œâ”€ åˆ›å»ºå·: docker_ccache-data
   â””â”€ å¯åŠ¨å®¹å™¨: my-cpp-dev
   
2. å·æŒ‚è½½
   â”œâ”€ é¡¹ç›®ç›®å½• â†’ /workspace
   â”œâ”€ ccacheç¼“å­˜ â†’ /workspace/.ccache
   â””â”€ Gité…ç½® â†’ /home/developer/.gitconfig
   
3. å®¹å™¨å¯åŠ¨
   â”œâ”€ ä»¥developerç”¨æˆ·èº«ä»½è¿è¡Œ
   â”œâ”€ å·¥ä½œç›®å½•: /workspace
   â””â”€ ä¿æŒè¿è¡ŒçŠ¶æ€ (tty: true, stdin_open: true)
```

## ğŸ› ï¸ å¸¸ç”¨Dockerå‘½ä»¤

### é•œåƒç®¡ç†

```bash
# æŸ¥çœ‹æœ¬åœ°é•œåƒ
docker images

# åˆ é™¤é•œåƒ
docker rmi my-cpp-project:ubuntu-focal

# æ„å»ºé•œåƒ
docker build -t my-cpp-project:ubuntu-focal docker/ubuntu-local/

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune
```

### å®¹å™¨ç®¡ç†

```bash
# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„ï¼‰
docker ps -a

# å¯åŠ¨å®¹å™¨
docker start my-cpp-dev

# åœæ­¢å®¹å™¨
docker stop my-cpp-dev

# åˆ é™¤å®¹å™¨
docker rm my-cpp-dev

# è¿›å…¥å®¹å™¨
docker exec -it my-cpp-dev bash

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs my-cpp-dev

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect my-cpp-dev
```

### Docker Compose å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆå‰å°ï¼‰
docker compose -f docker/docker-compose.yaml up

# å¯åŠ¨æœåŠ¡ï¼ˆåå°ï¼‰
docker compose -f docker/docker-compose.yaml up -d

# åœæ­¢å¹¶åˆ é™¤æœåŠ¡
docker compose -f docker/docker-compose.yaml down

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker compose -f docker/docker-compose.yaml up --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose -f docker/docker-compose.yaml ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker compose -f docker/docker-compose.yaml logs

# åœ¨æœåŠ¡ä¸­æ‰§è¡Œå‘½ä»¤
docker compose -f docker/docker-compose.yaml exec dev-environment bash
```

### å·å’Œç½‘ç»œç®¡ç†

```bash
# æŸ¥çœ‹å·
docker volume ls

# åˆ é™¤å·
docker volume rm docker_ccache-data

# æŸ¥çœ‹ç½‘ç»œ
docker network ls

# åˆ é™¤ç½‘ç»œ
docker network rm docker_default
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. å®¹å™¨å¯åŠ¨å¤±è´¥

**é—®é¢˜**: `docker compose up` å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
docker compose -f docker/docker-compose.yaml logs

# æ£€æŸ¥é•œåƒæ˜¯å¦å­˜åœ¨
docker images | grep my-cpp-project

# å¼ºåˆ¶é‡æ–°æ„å»º
docker compose -f docker/docker-compose.yaml up --build --force-recreate
```

#### 2. æ–‡ä»¶æƒé™é—®é¢˜

**é—®é¢˜**: å®¹å™¨å†…æ— æ³•è®¿é—®æŒ‚è½½çš„æ–‡ä»¶
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la

# ä¿®æ”¹æ–‡ä»¶æƒé™
chmod +x docker_build.sh auto_build.sh

# æ£€æŸ¥ç”¨æˆ·IDåŒ¹é…
docker exec -it my-cpp-dev id
```

#### 3. ç¼–è¯‘é”™è¯¯

**é—®é¢˜**: ç¼–è¯‘å¤±è´¥
```bash
# æ¸…ç†æ„å»ºç¼“å­˜
docker exec -it my-cpp-dev bash -c "cd /workspace && rm -rf build"

# æ£€æŸ¥ä¾èµ–
docker exec -it my-cpp-dev bash -c "gcc --version && cmake --version"

# æ‰‹åŠ¨è°ƒè¯•
docker exec -it my-cpp-dev bash
cd /workspace
mkdir build && cd build
cmake ..
make VERBOSE=1
```

#### 4. ç½‘ç»œé—®é¢˜

**é—®é¢˜**: æ— æ³•è®¿é—®å¤–ç½‘
```bash
# æ£€æŸ¥DNS
docker exec -it my-cpp-dev nslookup google.com

# é‡å¯DockeræœåŠ¡
sudo systemctl restart docker
```

#### 5. ç£ç›˜ç©ºé—´ä¸è¶³

**é—®é¢˜**: ç£ç›˜ç©ºé—´ä¸è¶³
```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a

# æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨
docker container prune

# æ¸…ç†æœªä½¿ç”¨çš„å·
docker volume prune

# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº
docker system prune -a
```

### è°ƒè¯•æŠ€å·§

```bash
# 1. æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
docker stats my-cpp-dev

# 2. è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it my-cpp-dev bash

# 3. æ£€æŸ¥æŒ‚è½½ç‚¹
docker exec -it my-cpp-dev df -h

# 4. æŸ¥çœ‹ç¯å¢ƒå˜é‡
docker exec -it my-cpp-dev env

# 5. æ£€æŸ¥ç½‘ç»œè¿æ¥
docker exec -it my-cpp-dev ping google.com
```

## ğŸ“š æœ€ä½³å®è·µ

### 1. é•œåƒä¼˜åŒ–
- ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°é•œåƒå¤§å°
- æ¸…ç†åŒ…ç®¡ç†å™¨ç¼“å­˜
- åˆå¹¶RUNæŒ‡ä»¤å‡å°‘å±‚æ•°

### 2. å®‰å…¨æ€§
- ä½¿ç”¨érootç”¨æˆ·è¿è¡Œå®¹å™¨
- åªè¯»æŒ‚è½½æ•æ„Ÿæ–‡ä»¶
- å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ

### 3. æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨ç¼–è¯‘ç¼“å­˜(ccache)
- æŒä¹…åŒ–æ•°æ®å·
- åˆç†è®¾ç½®èµ„æºé™åˆ¶

### 4. å¼€å‘æ•ˆç‡
- çƒ­é‡è½½ä»£ç å˜æ›´
- ç»Ÿä¸€å¼€å‘ç¯å¢ƒ
- è‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•

---

**ğŸ‰ æ­å–œï¼æ‚¨ç°åœ¨å·²ç»æŒæ¡äº†Dockerçš„æ ¸å¿ƒæ¦‚å¿µå’Œæœ¬é¡¹ç›®çš„å®Œæ•´å·¥ä½œæµç¨‹ï¼**

å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„è§£é‡Šï¼Œè¯·éšæ—¶è¯¢é—®ï¼